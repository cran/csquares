<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Csquares objects</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Csquares objects</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(csquares)</span></code></pre></div>
<div id="the-s3-class-csquares" class="section level2">
<h2>The S3 class <code>csquares</code></h2>
<p>The csquares package has defined a <code>csquares</code> class.
Objects that are of this class contain a <code>character</code> vector
or is a <code>character</code> vector itself, where the characters
represent valid <a href="https://en.wikipedia.org/wiki/C-squares">csquares</a> codes. The
advantage to have a distinct class for these objects is that you
automatically inherit all methods that are available for parent classes.
The <code>csquares</code> object can essentially inherit from the
following classes (arranged from simplest to most complex):</p>
<ul>
<li><code>character</code> vectors;</li>
<li><code>data.frame</code>;</li>
<li>spatial classes:
<ul>
<li>sf (<code>sf::st_sf()</code>);</li>
<li>stars (<code>stars::st_as_stars()</code>).</li>
</ul></li>
</ul>
<p>It is important to realise that <code>csquare</code> objects can have
varying parents, which is visualised in the diagram below. What you can
do with <code>csquares</code> objects in part depends on its parent.
Letâ€™s start with showing how <code>csqaures</code> objects are created
and how they will inherit properties from the different parents listed
above.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Csquares schematic Pages: 1 -->
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="283pt" height="429pt" viewBox="0.00 0.00 282.69 429.40">
  <g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 425.4)">
    <title>Csquares schematic</title>
    <polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-425.4 278.6921,-425.4 278.6921,4 -4,4"></polygon>
    <g id="clust1" class="cluster">
      <title>cluster_dfc</title>
      <polygon fill="#e0ffff" stroke="#000000" points="93.2244,-64 93.2244,-242 229.2244,-242 229.2244,-64 93.2244,-64"></polygon>
      <text text-anchor="middle" x="161.2244" y="-225.4" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">data.frame csquare</text>
    </g>
    <g id="clust2" class="cluster">
      <title>cluster_char</title>
      <polygon fill="#e0ffff" stroke="#000000" points="114.2244,-250 114.2244,-413.4 244.2244,-413.4 244.2244,-250 114.2244,-250"></polygon>
      <text text-anchor="middle" x="179.2244" y="-396.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">character csquare</text>
    </g>
    <!-- csquares -->
    <g id="node1" class="node csquare_nodes">
      <title>csquares</title>
      <polygon fill="#98fb98" stroke="#000000" points="207.5157,-36 134.9331,-36 134.9331,0 207.5157,0 207.5157,-36"></polygon>
      <text text-anchor="middle" x="171.2244" y="-13.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">csquares</text>
    </g>
    <!-- strucstrs -->
    <g id="node2" class="node csquare_nodes">
      <title>strucstrs</title>
      <g id="a_node2">
        <a xlink:href="#using-spatiotemporal-arrays-stars" xlink:title="{&lt;stars&gt;stars::stars|&lt;starscsq&gt;csquares}">
          <polygon fill="#ffffff" stroke="#000000" points="0,-72.5 0,-122.1 84.4488,-122.1 84.4488,-72.5 0,-72.5"></polygon>
          <text text-anchor="middle" x="42.2244" y="-105.5" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">stars::stars</text>
          <polyline fill="none" stroke="#000000" points="0,-97.3 84.4488,-97.3 "></polyline>
          <text text-anchor="middle" x="42.2244" y="-80.7" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">csquares</text>
        </a>
      </g>
    </g>
    <!-- strucstrs&#45;&gt;csquares -->
    <g id="edge5" class="edge">
      <title>strucstrs:starscsq-&gt;csquares</title>
      <path fill="none" stroke="#000000" d="M84.2244,-85.3C93.9484,-85.3 83.3778,-71.7701 89.2244,-64 98.4744,-51.7068 112.028,-42.2304 125.4626,-35.1629"></path>
      <polygon fill="#000000" stroke="#000000" points="127.2447,-38.1876 134.6901,-30.6499 124.1692,-31.8994 127.2447,-38.1876"></polygon>
    </g>
    <!-- strucdf -->
    <g id="node3" class="node csquare_nodes">
      <title>strucdf</title>
      <g id="a_node3">
        <a xlink:href="#using-data-frames" xlink:title="{&lt;df&gt;data.frame|&lt;dfcsq&gt;csquares}">
          <polygon fill="#ffffff" stroke="#000000" points="137.7714,-159.1 137.7714,-208.7 220.6774,-208.7 220.6774,-159.1 137.7714,-159.1"></polygon>
          <text text-anchor="middle" x="179.2244" y="-192.1" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">data.frame</text>
          <polyline fill="none" stroke="#000000" points="137.7714,-183.9 220.6774,-183.9 "></polyline>
          <text text-anchor="middle" x="179.2244" y="-167.3" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">csquares</text>
        </a>
      </g>
    </g>
    <!-- strucdf&#45;&gt;csquares -->
    <g id="edge3" class="edge">
      <title>strucdf:dfcsq-&gt;csquares</title>
      <path fill="none" stroke="#000000" d="M179.2244,-158.9C179.2244,-142.6143 183.1107,-138.8475 184.2244,-122.6 186.0055,-96.6165 187.7997,-89.7979 184.2244,-64 183.4127,-58.143 182.0458,-51.983 180.4956,-46.1423"></path>
      <polygon fill="#000000" stroke="#000000" points="183.733,-44.739 177.5878,-36.1085 177.0097,-46.6875 183.733,-44.739"></polygon>
    </g>
    <!-- strucsf -->
    <g id="node4" class="node csquare_nodes">
      <title>strucsf</title>
      <g id="a_node4">
        <a xlink:href="#using-simple-features-sf" xlink:title="{&lt;sf&gt;sf::sf|&lt;sfcsq&gt;csquares}">
          <polygon fill="#ffffff" stroke="#000000" points="102.8289,-72.5 102.8289,-122.1 175.6199,-122.1 175.6199,-72.5 102.8289,-72.5"></polygon>
          <text text-anchor="middle" x="139.2244" y="-105.5" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">sf::sf</text>
          <polyline fill="none" stroke="#000000" points="102.8289,-97.3 175.6199,-97.3 "></polyline>
          <text text-anchor="middle" x="139.2244" y="-80.7" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">csquares</text>
        </a>
      </g>
    </g>
    <!-- strucdf&#45;&gt;strucsf -->
    <g id="edge6" class="edge">
      <title>strucdf:df-&gt;strucsf:sf</title>
      <path fill="none" stroke="#000000" d="M138.2244,-195.9C124.3592,-195.9 134.7184,-154.7697 138.1965,-132.2755"></path>
      <polygon fill="#000000" stroke="#000000" points="141.6808,-132.6061 139.2244,-122.3 134.7177,-131.8885 141.6808,-132.6061"></polygon>
    </g>
    <!-- strucsf&#45;&gt;csquares -->
    <g id="edge4" class="edge">
      <title>strucsf:sfcsq-&gt;csquares</title>
      <path fill="none" stroke="#000000" d="M139.2244,-72.3C139.2244,-62.3921 143.2277,-52.6999 148.4024,-44.3104"></path>
      <polygon fill="#000000" stroke="#000000" points="151.2831,-46.2982 154.1002,-36.0847 145.5288,-42.3122 151.2831,-46.2982"></polygon>
    </g>
    <!-- strucchar -->
    <g id="node5" class="node csquare_nodes">
      <title>strucchar</title>
      <g id="a_node5">
        <a xlink:href="#using-characters" xlink:title="{&lt;character&gt;character|&lt;charcsq&gt;csquares}">
          <polygon fill="#ffffff" stroke="#000000" points="142.0533,-258.5 142.0533,-308.1 216.3955,-308.1 216.3955,-258.5 142.0533,-258.5"></polygon>
          <text text-anchor="middle" x="179.2244" y="-291.5" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">character</text>
          <polyline fill="none" stroke="#000000" points="142.0533,-283.3 216.3955,-283.3 "></polyline>
          <text text-anchor="middle" x="179.2244" y="-266.7" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">csquares</text>
        </a>
      </g>
    </g>
    <!-- strucchar&#45;&gt;csquares -->
    <g id="edge2" class="edge">
      <title>strucchar:charcsq-&gt;csquares</title>
      <path fill="none" stroke="#000000" d="M216.2244,-271.3C262.3708,-271.3 311.8454,-220.2289 233.2244,-64 229.021,-55.6474 222.504,-48.431 215.2466,-42.3518"></path>
      <polygon fill="#000000" stroke="#000000" points="217.2347,-39.4666 207.1554,-36.2017 212.9987,-45.0395 217.2347,-39.4666"></polygon>
    </g>
    <!-- strucchar&#45;&gt;strucdf -->
    <g id="edge7" class="edge">
      <title>strucchar:charcsq-&gt;strucdf:dfcsq</title>
      <path fill="none" stroke="#000000" d="M179.2244,-258.3C179.2244,-229.8701 210.5328,-235.927 220.2244,-209.2 224.1097,-198.4855 230.4883,-184.8733 228.7085,-177.4121"></path>
      <polygon fill="#000000" stroke="#000000" points="230.5169,-174.4132 220.2244,-171.9 226.7032,-180.2831 230.5169,-174.4132"></polygon>
    </g>
    <!-- strucchar&#45;&gt;strucsf -->
    <g id="edge8" class="edge">
      <title>strucchar:charcsq-&gt;strucsf:sfcsq</title>
      <path fill="none" stroke="#000000" d="M142.2244,-271.3C123.8303,-271.3 91.8658,-130.1624 97.8882,-93.7754"></path>
      <polygon fill="#000000" stroke="#000000" points="100.8581,-95.6272 103.2244,-85.3 94.9345,-91.8975 100.8581,-95.6272"></polygon>
    </g>
    <!-- vctr -->
    <g id="node6" class="node csquare_nodes">
      <title>vctr</title>
      <polygon fill="#ffffff" stroke="#000000" points="235.942,-380.6 122.5068,-380.6 122.5068,-344.6 235.942,-344.6 235.942,-380.6"></polygon>
      <text text-anchor="middle" x="179.2244" y="-358.4" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">vctrs::vctrs_vctr</text>
    </g>
    <!-- vctr&#45;&gt;strucchar -->
    <g id="edge1" class="edge">
      <title>vctr-&gt;strucchar:character</title>
      <path fill="none" stroke="#000000" d="M179.2244,-344.5C179.2244,-336.8287 179.2244,-327.5649 179.2244,-318.4443"></path>
      <polygon fill="#000000" stroke="#000000" points="182.7245,-318.3 179.2244,-308.3 175.7245,-318.3 182.7245,-318.3"></polygon>
    </g>
  </g>
</svg>

</div>
<div id="creating-csquares-objects" class="section level2">
<h2>Creating <code>csquares</code> objects</h2>
<div id="using-characters" class="section level3">
<h3>Using characters</h3>
<p>The simplest way of creating a <code>csquares</code> object is by
coercing other objects with <code>as_csquares()</code>. The example
below shows how to create a <code>csquares</code> object from a vector
of <code>characters</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>csquares_char <span class="ot">&lt;-</span> <span class="fu">as_csquares</span>(<span class="fu">c</span>(<span class="st">&quot;1000&quot;</span>, <span class="st">&quot;3000&quot;</span>, <span class="st">&quot;5000&quot;</span>, <span class="st">&quot;7000&quot;</span>))</span></code></pre></div>
</div>
<div id="using-data.frames" class="section level3">
<h3>Using data.frames</h3>
<p>Perhaps a more useful format is a <code>data.frame</code>, as you can
add data associated with the spatial squares. You can cast the previous
object to a <code>data.frame</code> and it will automatically inherit
the <code>csquares</code> class:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>csquares_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(csquares_char)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">class</span>(csquares_df)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;csquares&quot;   &quot;data.frame&quot;</span></span></code></pre></div>
<p>This means that you can apply all operations that you could apply to
a normal <code>data.frame</code>. This includes <a href="https://www.tidyverse.org">tidyverse</a> operations as explained
in more detail in <code>vignette(&quot;tidy&quot;)</code>. For example, you can
add columns with data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>csquares_df <span class="ot">&lt;-</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  csquares_df <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dummy =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code></pre></div>
<p>You can also cast a plain <code>data.frame</code> to a csquares
object. In that case, your <code>data.frame</code> should already
contain a column with csquares codes. All you have to do is specify
which column this is:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>orca_csq <span class="ot">&lt;-</span> <span class="fu">as_csquares</span>(orca, <span class="at">csquares =</span> <span class="st">&quot;csquares&quot;</span>)</span></code></pre></div>
</div>
<div id="using-simple-features-sf" class="section level3">
<h3>Using Simple Features (sf)</h3>
<p>Remember that csquares encode geographic rectangles, so it makes
sense to include this spatial information in the
<code>data.frame</code>. This is achieved by coercing a
<code>csquares</code> <code>data.frame</code> to a simple features
(<code>sf</code>) object. It too will automatically inherit the
<code>csquares</code> class:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; Warning: package &#39;sf&#39; was built under R version 4.3.3</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>csquares_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(csquares_df)</span></code></pre></div>
<p>The object <code>csquares_sf</code> now has a column holding the
csquares codes and a column containing the corresponding geometric
features. Both should represent the same spatial object. But be careful!
Not all methods are aware of this, so modifying the geometric column
might break this association.</p>
</div>
<div id="using-spatiotemporal-arrays-stars" class="section level3">
<h3>Using Spatiotemporal Arrays (stars)</h3>
<p><code>csquares</code> objects inheriting from the <code>stars</code>
are a little trickier. This is because there are more constraints: You
cannot include just any csquares at any location with varying
resolutions. At the moment <code>csquares</code> only support regular
linear grids where each grid cell size is the same as that of the
associated csquares. To create a <code>csquares</code>
<code>stars</code> object, you have to provide a bounding box and a
resolution in degrees:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; Warning: package &#39;stars&#39; was built under R version 4.3.3</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>csquares_stars <span class="ot">&lt;-</span> <span class="fu">new_csquares</span>(csquares_sf, <span class="at">resolution =</span> 10L)</span></code></pre></div>
<p>Even though we use the <code>csquares_sf</code> object to create the
grid, it doesnâ€™t include any of the columns from the <code>sf</code>
object in the resulting <code>stars</code> object. That is because only
the bounding box of <code>csquares_sf</code> is used to create
<code>csquares_stars</code>. You can add information to the grid by
matching the csquares codes:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">## create an empty column:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>csquares_stars[[<span class="st">&quot;dummy&quot;</span>]] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>csquares_stars[[<span class="st">&quot;dummy&quot;</span>]] <span class="ot">&lt;-</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  csquares_df[[<span class="st">&quot;dummy&quot;</span>]] [</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    <span class="fu">match</span>(csquares_stars[[<span class="st">&quot;csquares&quot;</span>]], csquares_df[[<span class="st">&quot;csquares&quot;</span>]])</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  ]</span></code></pre></div>
<p>Or simply use <code>left_join()</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>csquares_stars <span class="ot">&lt;-</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="fu">left_join</span>(csquares_stars,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>            <span class="fu">data.frame</span>(<span class="at">csquares =</span> <span class="st">&quot;1000&quot;</span>, <span class="at">foo =</span> <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;csquares&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="validating-csquares-objects" class="section level2">
<h2>Validating <code>csquares</code> objects</h2>
<p>When creating a csquares object with <code>as_csquares</code>, it is
not allowed to pass illegal codes, or codes with wildcards (see
<code>vignette(&quot;wildcards&quot;)</code>). It will throw an error. You could
try to work around this and create a fake <code>csquares</code> object
by assigning the class manually to an illegal code. However, if you test
its validity you will see that it is not going to fly:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">## Let&#39;s create a fake csquares object with a code that is merely impossible:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>fake_csquares <span class="ot">&lt;-</span> <span class="st">&quot;1099&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">class</span>(fake_csquares) <span class="ot">&lt;-</span> <span class="st">&quot;csquares&quot;</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="do">## Of course this isn&#39;t valid</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="fu">validate_csquares</span>(fake_csquares)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="do">## This one is:</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">validate_csquares</span>(csquares_char)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
